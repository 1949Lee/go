<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- <title>博客测试网页</title> -->
    <title></title>
    <link rel="stylesheet/less" href="index.less">
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/styles/default.min.css">
</head>
<body>
<div style="text-align: center">
    <label for="content">text</label>
</div>
<div style="text-align: center">
    <textarea id="content" style="border: 1px solid rgba(0,0,0,.267);" cols="100" rows="20" onkeydown="textInput(event)"></textarea>
    <div id="result"
         style="border: 1px solid rgba(0,0,0,.267);display: inline-block;width: 622px;height: 306px;overflow-y: auto;text-align: left">
    </div>
</div>
<div style="text-align: center">
    <button type="button" onclick="save()">确认</button>
</div>


<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.10/highlight.min.js"></script>
<script src="less.min.js"></script>
<script>
    function save() {
        let xhr = new XMLHttpRequest();
        xhr.open("POST", "http://127.0.0.1:1314", true);
        xhr.setRequestHeader("Content-Type", "application/json; charset=utf-8");
        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                console.log("发送成功：", JSON.parse(xhr.responseText).data.list);
                // let html = "";
                // let list = JSON.parse(xhr.responseText).data.list;
                // for (let i = 0; i < list.length; i++) {
                //     html += list[i].html;
                // }
                document.getElementById('result').innerHTML = JSON.parse(xhr.responseText).data.html;
                setTimeout(function () {
                    document.querySelectorAll('pre code').forEach((block) => {
                        hljs.highlightBlock(block);
                    });
                },0);
            }
        };
        xhr.send(JSON.stringify({text: document.getElementById('content').value}))
    }

    function textInput(e) {
        if(e.key.toUpperCase() === 'TAB') {
            var index = e.target.selectionStart;
            e.target.value = e.target.value.substring(0,e.target.selectionStart) + "    " + e.target.value.substring(e.target.selectionStart);
            e.target.setSelectionRange(index + 4,index + 4)
            e.preventDefault();
        }
    }

</script>

</body>
</html>
